<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ£åœ°å·¡ç¤¼è§’è‰²å®æ™¯åˆæˆå™¨</title>
    <link rel="stylesheet" href="style.less">
</head>

<body>
    <main class="app-container">
        <header>
            <h1 data-i18n="header.title">åœ£åœ°å·¡ç¤¼è§’è‰²å®æ™¯åˆæˆå™¨</h1>
            <button id="lang-toggle" class="ui-btn secondary-btn lang-btn" data-i18n="btn.lang_toggle">English</button>
        </header>

        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="tab-btn active" data-mode="local" data-i18n="tab.local">æœ¬åœ°æå–</button>
            <button class="tab-btn" data-mode="ai" data-i18n="tab.ai">AI ç”Ÿæˆ (Nano Banana Pro ğŸŒ)</button>
        </div>

        <img class="output-image">

        <!-- Local Mode Controls -->
        <div id="controls-local" class="config-box">
            <!-- Image Settings Group -->
            <div class="control-group">
                <div class="compact-control-row">
                    <label data-i18n="label.margin">è¾¹æ¡†</label>
                    <input type="range" min="0" max="100" step="1" value="0" class="input-range-margin-overlay">
                    <span class="config-margin-value-overlay value-text">0</span>
                </div>
                <div class="compact-control-row">
                    <label data-i18n="label.background">åº•è‰²</label>
                    <div class="color-picker-wrapper">
                        <input type="color" value="#EEEEEE" class="input-background-color-overlay">
                    </div>
                    <span class="config-background-color-overlay value-text">#EEEEEE</span>
                </div>
            </div>

            <!-- Extract Button -->
            <div class="action-box">
                <button class="ui-btn extract-btn" onclick="extractCharacter()" data-i18n="btn.extract">
                    æå–è§’è‰²
                </button>
                <div class="model-status"></div>
            </div>

            <!-- Character Adjustment Group -->
            <div class="control-group">
                <div class="compact-control-row">
                    <label data-i18n="label.scale">å¤§å°</label>
                    <input type="range" min="10" max="200" step="5" value="100" class="input-character-scale">
                    <span class="config-scale-value value-text">100%</span>
                </div>
                <div class="compact-control-row">
                    <label data-i18n="label.opacity">é€æ˜</label>
                    <input type="range" min="0" max="100" step="5" value="100" class="input-character-opacity">
                    <span class="config-opacity-value value-text">100%</span>
                </div>
            </div>
        </div>

        <!-- AI Mode Controls -->
        <div id="controls-ai" class="config-box" style="display: none;">
            <!-- Image Settings Group (Shared) -->
            <div class="control-group">
                <div class="compact-control-row">
                    <label data-i18n="label.margin">è¾¹æ¡†</label>
                    <input type="range" min="0" max="100" step="1" value="0" class="input-range-margin-overlay">
                    <span class="config-margin-value-overlay value-text">0</span>
                </div>
                <div class="compact-control-row">
                    <label data-i18n="label.background">åº•è‰²</label>
                    <div class="color-picker-wrapper">
                        <input type="color" value="#EEEEEE" class="input-background-color-overlay">
                    </div>
                    <span class="config-background-color-overlay value-text">#EEEEEE</span>
                </div>
            </div>

            <div class="control-group">
                <div class="input-group">
                    <label for="gemini-api-key" data-i18n="input.apikey.label">Google AI Studio API Key <a
                            href="https://ai.google.dev/gemini-api/docs/pricing?hl=zh-cn#gemini-3-pro-image-preview"
                            target="_blank">ï¼ˆç”Ÿæˆä¸€å¼ å›¾ç‰‡çº¦$0.24ç¾å…ƒï¼‰</a></label>
                    <input type="password" id="gemini-api-key" placeholder="è¯·è¾“å…¥æ‚¨çš„ Google AI Studio API Key"
                        data-i18n-placeholder="input.apikey.placeholder">
                    <small><a href="https://aistudio.google.com/app/apikey" target="_blank" data-i18n="link.apikey">å¦‚ä½•è·å–
                            API
                            Key</a></small>
                </div>
                <div class="input-group">
                    <label for="gemini-prompt" data-i18n="input.prompt.label">æç¤ºè¯ï¼ˆPromptï¼‰</label>
                    <textarea id="gemini-prompt" rows="8">You are an expert image compositor. Task: Extract the anime character from the first image and composite it seamlessly into the second background image. 
Requirements:
1. Precise segmentation of the character.
2. Adjust lighting, shadows, and color tone of the character to match the background environment perfectly.
3. Maintain the character's original design and details.
4. Output ONLY the final composite image.</textarea>
                </div>
            </div>

            <div class="action-box">
                <button class="ui-btn extract-btn" id="start-ai-gen-btn" data-i18n="btn.start_ai">
                    å¼€å§‹ AI ç”Ÿæˆ
                </button>
                <div id="ai-status" class="model-status"></div>
            </div>
        </div>

        <div class="output-box">
            <!-- Local Mode Buttons -->
            <div id="btns-local" class="btn-group">
                <a class="ui-btn download-btn" target="_blank" data-i18n="btn.save_comparison">ä¿å­˜å¯¹æ¯”å›¾ç‰‡</a>
                <button class="ui-btn download-bg-btn" style="display: none;"
                    data-i18n="btn.save_bg_only">ä»…ä¿å­˜å®æ™¯åˆæˆå›¾ç‰‡</button>
                <button class="ui-btn download-character-btn" onclick="downloadCharacter()" style="display: none;"
                    data-i18n="btn.save_char_only">
                    ä»…ä¿å­˜æå–è§’è‰²
                </button>
                <button class="ui-btn secondary-btn" id="switch-to-ai-btn" style="display: none;"
                    data-i18n="btn.switch_to_ai">
                    å¯¹ç»“æœä¸æ»¡æ„ï¼Ÿå°è¯• AI ç”Ÿæˆ
                </button>
            </div>

            <!-- AI Mode Buttons -->
            <div id="btns-ai" class="btn-group" style="display: none;">
                <button id="download-ai-comparison-btn" class="ui-btn download-btn" style="display: none;"
                    data-i18n="btn.save_comparison">ä¿å­˜å¯¹æ¯”å›¾ç‰‡</button>
                <button id="download-ai-result-btn" class="ui-btn download-bg-btn" style="display: none;"
                    data-i18n="btn.save_bg_only">ä»…ä¿å­˜å®æ™¯ç”Ÿæˆå›¾ç‰‡</button>
            </div>

            <button class="ui-btn reset-btn" data-i18n="btn.reset">é‡æ–°å¼€å§‹</button>
        </div>

        <div class="content-box">
            <br>
            <p>
                <span data-i18n="text.map_link">åœ¨åœ°å›¾ä¸­å¯»æ‰¾åœ£åœ°</span>
                <a href="https://anitabi.cn/map" target="_blank">https://anitabi.cn</a>
            </p>
            <p data-i18n="text.intro">
                å°†åŠ¨æ¼«è§’è‰²æ”¾ç½®åœ¨å®æ‹ç…§ç‰‡ä¸­ï¼
            </p>
            <p data-i18n="text.disclaimer">
                ç¦æ­¢å•†ä¸šç”¨é€”ï¼ŒåŠ¨ç”»æˆªå›¾å½’å±åŠ¨ç”»å§”å‘˜ä¼š
            </p>
        </div>

        <footer>
            <a href="https://lab.magiconch.com/image-merge/" target="_blank" data-i18n="footer.credit">æœ¬é¡¹ç›®åŸºäºImage
                Mergeé¡¹ç›®å¼€å‘</a>
            <br>
            <br>
            <a href="https://github.com/haoyang504/Anime_In_Real" target="_blank">GitHub</a>
        </footer>
    </main>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h3 data-i18n="modal.confirm.title">ç¡®è®¤ç”Ÿæˆï¼Ÿ</h3>
            <p data-i18n="modal.confirm.desc">æ­¤åŠŸèƒ½éœ€è¦ä½¿ç”¨æ‚¨è‡ªå·±çš„ Google AI Studio API Key</p>
            <p class="warning-text" data-i18n="modal.confirm.warning">âš ï¸ ç”Ÿæˆä¸€å¼ å›¾ç‰‡çº¦éœ€èŠ±è´¹ $0.24 ç¾å…ƒ</p>
            <div class="modal-actions">
                <button id="cancel-gen-btn" class="ui-btn secondary-btn" style="background: #f3f4f6; color: #1f2937;"
                    data-i18n="btn.cancel">å–æ¶ˆ</button>
                <button id="confirm-gen-btn" class="ui-btn extract-btn" data-i18n="btn.confirm">ç¡®è®¤ç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <script type="module" src="/main.js"></script>
    <script type="module" src="/interactions.js"></script>
</body>

</html>